<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="components/htmlComponents::htmlHead"/>
<body class="d-flex flex-column min-vh-100">
<header th:replace="components/navbars:: navbar-admin"/>

<div class="container py-3">
    <div th:replace="components/titles::titles ('Blog', ${ {'Blog','Formulario'} })"/>
    <form th:action="@{/blog/admin/save}" method="post" th:object="${news}" onsubmit="return false" >
        <input type="hidden" id="id" name="id" th:field="*{id}"/>
        <input type="hidden" name="image" id="image" th:field="*{image}"/>

        <div class="form-row">
            <div class="form-group col-12 col-md-8">
                <label for="title">Título:</label>
                <input type="text" class="form-control"
                       id="title" name="title"
                       aria-describedby="titleHelp"
                       placeholder="Ej: La vida de las mascotas"
                       th:classappend="${#fields.hasErrors('title')?'is-invalid':''}"
                       th:field="*{title}"
                       autofocus
                       required
                       minlength="2"
                       maxlength="50"
                       pattern="[A-Za-zÀ-ÿ '-.]*"
                />
                <div id="titleHelp"
                     th:classappend="${#fields.hasErrors('title')?'invalid-feedback':''}"
                     th:errors="*{title}">
                </div>
            </div>
            <div class="form-group col-12 col-md-4">
                <label for="tags">Etiquetas:</label>
                <select class="form-control selectpicker"
                        id="tags" name="tags"
                        multiple data-live-search="true">
                    <option th:each="tag: ${tagsList}" th:value="${tag.id}" th:text="${tag.name}"/>
                </select>
                <!--<div id="tagsHelp"
                     th:classappend="${#fields.hasErrors('tags')?'invalid-feedback':''}"
                     th:errors="*{tags}">
                </div>-->
                <input type="hidden" th:name="tagValues" id="tagValues">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-12 col-md-4">
                <div class="form-group">
                    <label for="preImage">Imagen:</label>
                    <input type="file" class="form-control-file" id="preImage" name="preImage" accept=".png, .jpg, .jpeg">
                </div>
            </div>
            <div class="form-group col-12 col-md-4 text-center">
                <img th:src="${news.image}" width="150" height="auto">
            </div>
            <div class="form-group col-12 col-md-4">
                <div>Opciones de publicado:</div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="isMail" id="isMain" th:field="*{isMain}">
                    <label class="form-check-label" for="isMain">
                        Guardar y mostrar al público
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="isPublished" id="isPublished" th:field="*{isPublished}">
                    <label class="form-check-label" for="isPublished">
                        Solo guardar
                    </label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="content">Contenido:</label>
            <textarea id="content" name="content" th:field="*{content}" minlength="10" required/>
            <div id="contentHelp"
                 th:classappend="${#fields.hasErrors('content')?'invalid-feedback':''}"
                 th:errors="*{content}">
            </div>
        </div>

        <button type="submit" class="btn btn-success" onclick="uploadImageBlog(this.form)">Guardar</button>
    </form>
</div>

<footer th:replace="components/htmlComponents::htmlFooter"/>
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
<script>
    $('#content').summernote({
        placeholder: 'Aquí puedes comenzar a escribir tu grandiosa publicación', lang: 'ko-KR', tabsize: 2, height: 300,
    });
    $('select').selectpicker();
    $('#tags').on("change", (e => {
        const options = e.target.selectedOptions
        if (!options || options.length < 0) return
        let values = []
        for (const option of options) {
            values.push(option.value)
        }
        $('#tagValues').val(values.join(","))
    }))
</script>
<script th:src="@{/js/uploadImages.js}"></script>
</body>
</html>

